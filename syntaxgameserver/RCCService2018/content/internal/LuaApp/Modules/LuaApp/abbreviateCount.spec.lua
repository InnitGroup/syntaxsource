return function()
	local Modules = game:GetService("CoreGui").RobloxGui.Modules
	local CorePackages = game:GetService("CorePackages")
	local Logging = require(CorePackages.Logging)
	local abbreviateCount = require(Modules.LuaApp.abbreviateCount)

	local function checkLocale(locale, responseMapping)
		for input, output in pairs(responseMapping) do
			expect(abbreviateCount(input, locale)).to.equal(output)
		end
	end

	local function checkValidUsEnglishForLocale(locale)
		checkLocale(locale, {
			[0] = "0",
			[1] = "1",
			[25] = "25",
			[364] = "364",
			[4120] = "4.1K",
			[57860] = "57.9K",
			[624390] = "624K",
			[999999] = "1M",
			[7857000] = "7.9M",
			[8e7] = "80M",
			[9e8] = "900M",
			[1e9] = "1B",
			[1e12] = "1,000B",
			[-1] = "-1",
			[-25] = "-25",
			[-364] = "-364",
			[-4120] = "-4.1K",
			[-57860] = "-57.9K",
			[-624390] = "-624K",
			[-999999] = "-1M",
			[-7857000] = "-7.9M",
			[-8e7] = "-80M",
			[-9e8] = "-900M",
			[-1e9] = "-1B",
			[-1e12] = "-1,000B",
			[1.1] = "1.1",
			[1499.99] = "1.5K",
			[-1.1] = "-1.1",
			[-1499.99] = "-1.5K",
		})
	end

	local function checkValidSpanishForLocale(locale)
		checkLocale("es-es", {
			[0] = "0",
			[1] = "1",
			[25] = "25",
			[364] = "364",
			[4120] = "4,1 mil",
			[57860] = "57,9 mil",
			[624390] = "624 mil",
			[999999] = "1 M",
			[7857000] = "7,9 M",
			[8e7] = "80 M",
			[9e8] = "900 M",
			[1e9] = "1.000 M",
			[-1] = "-1",
			[-25] = "-25",
			[-364] = "-364",
			[-4120] = "-4,1 mil",
			[-57860] = "-57,9 mil",
			[-624390] = "-624 mil",
			[-999999] = "-1 M",
			[-7857000] = "-7,9 M",
			[-8e7] = "-80 M",
			[-9e8] = "-900 M",
			[-1e9] = "-1.000 M",
			[1.1] = "1,1",
			[1499.99] = "1,5 mil",
			[-1.1] = "-1,1",
			[-1499.99] = "-1,5 mil",
		})
	end

	describe("abbreviateCount", function()
		it("should default to en-us when locale is not recognized", function()
			local logs = Logging.capture(function()
				checkValidUsEnglishForLocale("bad_locale")
			end)
			expect(string.match(logs.warnings[1], "^Warning: Locale not found:") ~= nil).to.equal(true)
		end)

		it("should default to en-us when locale is nil", function()
			local logs = Logging.capture(function()
				checkValidUsEnglishForLocale(nil)
			end)
			expect(string.match(logs.warnings[1], "^Warning: Locale not found:") ~= nil).to.equal(true)
		end)

		it("should default to en-us when locale is empty", function()
			local logs = Logging.capture(function()
				checkValidUsEnglishForLocale("")
			end)
			expect(string.match(logs.warnings[1], "^Warning: Locale not found:") ~= nil).to.equal(true)
		end)

		it("should abbreviate correctly. (en-us)", function()
			checkValidUsEnglishForLocale("en-us")
		end)

		it("should abbreviate correctly. (en-gb)", function()
			checkValidUsEnglishForLocale("en-gb")
		end)

		it("should abbreviate correctly. (es-es)", function()
			checkValidSpanishForLocale("es-es")
		end)

		it("should abbreviate correctly. (fr-fr)", function()
			checkLocale("fr-fr", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 k",
				[57860] = "57,9 k",
				[624390] = "624 k",
				[999999] = "1 M",
				[7857000] = "7,9 M",
				[80000000] = "80 M",
				[900000000] = "900 M",
				[1000000000] = "1 Md",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 k",
				[-57860] = "-57,9 k",
				[-624390] = "-624 k",
				[-999999] = "-1 M",
				[-7857000] = "-7,9 M",
				[-80000000] = "-80 M",
				[-900000000] = "-900 M",
				[-1000000000] = "-1 Md",
				[1.1] = "1,1",
				[1499.99] = "1,5 k",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 k",
			})
		end)

		it("should abbreviate correctly. (de-de)", function()
			checkLocale("de-de", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 Tsd.",
				[57860] = "57,9 Tsd.",
				[624390] = "624 Tsd.",
				[999999] = "1 Mio.",
				[7857000] = "7,9 Mio.",
				[80000000] = "80 Mio.",
				[900000000] = "900 Mio.",
				[1000000000] = "1 Mrd.",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 Tsd.",
				[-57860] = "-57,9 Tsd.",
				[-624390] = "-624 Tsd.",
				[-999999] = "-1 Mio.",
				[-7857000] = "-7,9 Mio.",
				[-80000000] = "-80 Mio.",
				[-900000000] = "-900 Mio.",
				[-1000000000] = "-1 Mrd.",
				[1.1] = "1,1",
				[1499.99] = "1,5 Tsd.",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 Tsd.",
			})
		end)

		it("should abbreviate correctly. (pt-br)", function()
			checkLocale("pt-br", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 mil",
				[57860] = "57,9 mil",
				[624390] = "624 mil",
				[999999] = "1 mi",
				[7857000] = "7,9 mi",
				[80000000] = "80 mi",
				[900000000] = "900 mi",
				[1000000000] = "1 bi",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 mil",
				[-57860] = "-57,9 mil",
				[-624390] = "-624 mil",
				[-999999] = "-1 mi",
				[-7857000] = "-7,9 mi",
				[-80000000] = "-80 mi",
				[-900000000] = "-900 mi",
				[-1000000000] = "-1 bi",
				[1.1] = "1,1",
				[1499.99] = "1,5 mil",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 mil",
			})
		end)

		it("should abbreviate correctly. (zh-cn)", function()
			checkLocale("zh-cn", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4.1千",
				[9999] = "1万",
				[57860] = "5.8万",
				[624390] = "62.4万",
				[7857000] = "786万",
				[80000000] = "8,000万",
				[900000000] = "9亿",
				[1000000000] = "10亿",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4.1千",
				[-9999] = "-1万",
				[-57860] = "-5.8万",
				[-624390] = "-62.4万",
				[-7857000] = "-786万",
				[-80000000] = "-8,000万",
				[-900000000] = "-9亿",
				[-1000000000] = "-10亿",
				[1.1] = "1.1",
				[1499.99] = "1.5千",
				[-1.1] = "-1.1",
				[-1499.99] = "-1.5千",
			})
		end)

		it("should abbreviate correctly. (zh-tw)", function()
			checkLocale("zh-tw", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4.1千",
				[9999] = "1萬",
				[57860] = "5.8萬",
				[624390] = "62.4萬",
				[7857000] = "786萬",
				[80000000] = "8,000萬",
				[900000000] = "9億",
				[1000000000] = "10億",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4.1千",
				[-9999] = "-1萬",
				[-57860] = "-5.8萬",
				[-624390] = "-62.4萬",
				[-7857000] = "-786萬",
				[-80000000] = "-8,000萬",
				[-900000000] = "-9億",
				[-1000000000] = "-10億",
				[1.1] = "1.1",
				[1499.99] = "1.5千",
				[-1.1] = "-1.1",
				[-1499.99] = "-1.5千",
			})
		end)

		it("should abbreviate correctly. (ko-kr)", function()
			checkLocale("ko-kr", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4.1천",
				[9999] = "1만",
				[57860] = "5.8만",
				[624390] = "62.4만",
				[7857000] = "786만",
				[80000000] = "8,000만",
				[900000000] = "9억",
				[1000000000] = "10억",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4.1천",
				[-9999] = "-1만",
				[-57860] = "-5.8만",
				[-624390] = "-62.4만",
				[-7857000] = "-786만",
				[-80000000] = "-8,000만",
				[-900000000] = "-9억",
				[-1000000000] = "-10억",
				[1.1] = "1.1",
				[1499.99] = "1.5천",
				[-1.1] = "-1.1",
				[-1499.99] = "-1.5천",
			})
		end)

		it("should abbreviate correctly. (ja-jp)", function()
			checkLocale("ja-jp", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4.1千",
				[9999] = "1万",
				[57860] = "5.8万",
				[624390] = "62.4万",
				[7857000] = "786万",
				[80000000] = "8,000万",
				[900000000] = "9億",
				[1000000000] = "10億",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4.1千",
				[-9999] = "-1万",
				[-57860] = "-5.8万",
				[-624390] = "-62.4万",
				[-7857000] = "-786万",
				[-80000000] = "-8,000万",
				[-900000000] = "-9億",
				[-1000000000] = "-10億",
				[1.1] = "1.1",
				[1499.99] = "1.5千",
				[-1.1] = "-1.1",
				[-1499.99] = "-1.5千",
			})
		end)

		it("should abbreviate correctly. (it-it)", function()
			checkLocale("it-it", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 mila",
				[57860] = "57,9 mila",
				[624390] = "624 mila",
				[999999] = "1 Mln",
				[7857000] = "7,9 Mln",
				[80000000] = "80 Mln",
				[900000000] = "900 Mln",
				[1000000000] = "1 Mld",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 mila",
				[-57860] = "-57,9 mila",
				[-624390] = "-624 mila",
				[-999999] = "-1 Mln",
				[-7857000] = "-7,9 Mln",
				[-80000000] = "-80 Mln",
				[-900000000] = "-900 Mln",
				[-1000000000] = "-1 Mld",
				[1.1] = "1,1",
				[1499.99] = "1,5 mila",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 mila",
			})
		end)

		it("should abbreviate correctly. (ru-ru)", function()
			checkLocale("ru-ru", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 тыс",
				[57860] = "57,9 тыс",
				[624390] = "624 тыс",
				[999999] = "1 млн",
				[7857000] = "7,9 млн",
				[80000000] = "80 млн",
				[900000000] = "900 млн",
				[1000000000] = "1 млрд",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 тыс",
				[-57860] = "-57,9 тыс",
				[-624390] = "-624 тыс",
				[-999999] = "-1 млн",
				[-7857000] = "-7,9 млн",
				[-80000000] = "-80 млн",
				[-900000000] = "-900 млн",
				[-1000000000] = "-1 млрд",
				[1.1] = "1,1",
				[1499.99] = "1,5 тыс",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 тыс",
			})
		end)

		it("should abbreviate correctly. (es-mx)", function()
			checkValidSpanishForLocale("es-mx")
		end)

		it("should abbreviate correctly. (id-id)", function()
			checkLocale("id-id", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 rb",
				[57860] = "57,9 rb",
				[624390] = "624 rb",
				[999999] = "1 jt",
				[7857000] = "7,9 jt",
				[80000000] = "80 jt",
				[900000000] = "900 jt",
				[1000000000] = "1 M",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 rb",
				[-57860] = "-57,9 rb",
				[-624390] = "-624 rb",
				[-999999] = "-1 jt",
				[-7857000] = "-7,9 jt",
				[-80000000] = "-80 jt",
				[-900000000] = "-900 jt",
				[-1000000000] = "-1 M",
				[1.1] = "1,1",
				[1499.99] = "1,5 rb",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 rb",
			})
		end)

		it("should abbreviate correctly. (vi-vn)", function()
			checkLocale("vi-vn", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4.1 N",
				[57860] = "57.9 N",
				[624390] = "624 N",
				[999999] = "1 Tr",
				[7857000] = "7.9 Tr",
				[80000000] = "80 Tr",
				[900000000] = "900 Tr",
				[1000000000] = "1 T",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4.1 N",
				[-57860] = "-57.9 N",
				[-624390] = "-624 N",
				[-999999] = "-1 Tr",
				[-7857000] = "-7.9 Tr",
				[-80000000] = "-80 Tr",
				[-900000000] = "-900 Tr",
				[-1000000000] = "-1 T",
				[1.1] = "1.1",
				[1499.99] = "1.5 N",
				[-1.1] = "-1.1",
				[-1499.99] = "-1.5 N",
			})
		end)

		it("should abbreviate correctly. (th-th)", function()
			checkLocale("th-th", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4.1 พ",
				[57860] = "5.8 ม",
				[624390] = "6.2 ส",
				[999999] = "1 ล",
				[7857000] = "7.9 ล",
				[80000000] = "80 ล",
				[900000000] = "900 ล",
				[1000000000] = "1,000 ล",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4.1 พ",
				[-57860] = "-5.8 ม",
				[-624390] = "-6.2 ส",
				[-999999] = "-1 ล",
				[-7857000] = "-7.9 ล",
				[-80000000] = "-80 ล",
				[-900000000] = "-900 ล",
				[-1000000000] = "-1,000 ล",
				[1.1] = "1.1",
				[1499.99] = "1.5 พ",
				[-1.1] = "-1.1",
				[-1499.99] = "-1.5 พ",
			})
		end)

		it("should abbreviate correctly. (tr-tr)", function()
			checkLocale("tr-tr", {
				[0] = "0",
				[1] = "1",
				[25] = "25",
				[364] = "364",
				[4120] = "4,1 B",
				[57860] = "57,9 B",
				[624390] = "624 B",
				[999999] = "1 Mn",
				[7857000] = "7,9 Mn",
				[80000000] = "80 Mn",
				[900000000] = "900 Mn",
				[1000000000] = "1 Mr",
				[-1] = "-1",
				[-25] = "-25",
				[-364] = "-364",
				[-4120] = "-4,1 B",
				[-57860] = "-57,9 B",
				[-624390] = "-624 B",
				[-999999] = "-1 Mn",
				[-7857000] = "-7,9 Mn",
				[-80000000] = "-80 Mn",
				[-900000000] = "-900 Mn",
				[-1000000000] = "-1 Mr",
				[1.1] = "1,1",
				[1499.99] = "1,5 B",
				[-1.1] = "-1,1",
				[-1499.99] = "-1,5 B",
			})
		end)
	end)
end
